# 机器人命令

## @bot 中文指令

在频道中 @机器人 发送：

### 音乐

> 点歌前需先加入语音频道，Bot 会跟随你进入该频道后放歌。

| 指令 | 说明 |
|------|------|
| `@bot 播放<歌名>` | 搜索并播放网易云音乐 |
| `@bot 停止` | 停止当前播放 |
| `@bot 下一首` | 切换到队列中下一首 |
| `@bot 队列` | 查看当前播放队列 |
| `@bot 随机` | 随机播放喜欢的歌曲 |
| `@bot 喜欢列表` | 查看喜欢的音乐列表 |

### AI

| 指令 | 说明 |
|------|------|
| `@bot 画<描述>` | AI 生成图片 |
| `@bot <任意内容>` | AI 聊天（未匹配其他指令时兜底） |

### 查询

| 指令 | 说明 |
|------|------|
| `@bot 查封号 <QQ号>` | 查询 LOL 封号状态 |
| `@bot 战绩 <召唤师名#编号>` | 查询 LOL 战绩 |
| `@bot 个人信息` | 查看个人详细信息 |
| `@bot 我的资料` | 查看自身详细资料 |
| `@bot 查看 <用户名>` | 查看他人详细资料 |
| `@bot 角色 <用户名>` | 查看用户在域内的角色/禁言状态 |
| `@bot 可分配角色 <用户名>` | 查看可分配的角色列表 |
| `@bot 搜索 <关键词>` | 搜索域成员 |
| `@bot 语音` | 查看语音频道在线成员 |
| `@bot 成员` | 查看域成员在线状态 |
| `@bot 每日一句` | 获取每日名言 |

### 管理

| 指令 | 说明 |
|------|------|
| `@bot 禁言 <用户> [时长]` | 禁言用户（默认 10 分钟） |
| `@bot 解禁 <用户>` | 解除禁言 |
| `@bot 禁麦 <用户> [时长]` | 禁麦用户 |
| `@bot 解麦 <用户>` | 解除禁麦 |
| `@bot 移出域 <用户>` / `@bot 踢出 <用户>` | 将用户移出当前域 |
| `@bot 解除域内封禁 <用户>` / `@bot 解封 <用户>` | 从域封禁列表移除（解除域内封禁） |
| `@bot 封禁列表` / `@bot 封禁名单` | 查看当前域封禁列表 |
| `@bot 撤回` | 撤回最后一条消息 |
| `@bot 撤回<消息ID>` | 撤回指定消息 |
| `@bot 撤回N条` | 批量撤回 N 条消息（最多 100 条） |
| `@bot 清理历史` | 清理播放历史和日志 |
| `@bot 帮助` | 显示帮助信息 |

> 用户名支持三种格式：`@mention`、32 位 UID、名称映射中的昵称。

## / 斜杠命令

### 音乐

> 点歌前需先加入语音频道。

| 命令 | 说明 |
|------|------|
| `/bf <歌名>` 或 `/play <歌名>` | 搜索并播放 |
| `/st` 或 `/stop` | 停止播放 |
| `/next` | 下一首 |
| `/queue` | 查看播放队列 |
| `/like` | 随机播放 1 首喜欢的歌 |
| `/like <数量>` | 随机播放多首 |
| `/like list [页码]` | 查看喜欢列表（分页） |
| `/like play <编号>` | 播放喜欢列表中指定歌曲 |

### 查询

> 以下两条为插件命令，需对应插件已加载且配置 `enabled: true`。

| 命令 | 说明 |
|------|------|
| `/lol <QQ号>` | 查询 LOL 封号状态 |
| `/zj <召唤师名#编号>` | 查询 LOL 战绩 |
| `/me` | 查看个人信息 |
| `/myinfo` | 自身详细资料 |
| `/whois <用户名>` | 查看他人详细资料 |
| `/role <用户名>` | 查看用户域内角色/禁言状态 |
| `/roles <用户名>` | 可分配的角色列表 |
| `/search <关键词>` | 搜索域成员 |
| `/voice` | 语音频道在线成员 |
| `/enter <频道ID>` | 进入指定频道 |
| `/members` | 查看域成员在线 |
| `/daily` 或 `/quote` | 获取每日语录 |

### 管理

| 命令 | 说明 |
|------|------|
| `/禁言 <用户> [时长]` 或 `/mute` | 禁言用户 |
| `/解禁 <用户>` 或 `/unmute` | 解除禁言 |
| `/禁麦 <用户>` 或 `/mutemic` | 禁麦用户 |
| `/解麦 <用户>` 或 `/unmutemic` | 解除禁麦 |
| `/ban <用户>` | 将用户移出当前域（踢出域） |
| `/unblock <用户>` | 从域封禁列表移除（解除域内封禁，可先 `/blocklist` 查看） |
| `/blocklist` | 查看当前域封禁列表 |
| `/recall <消息ID>` | 撤回指定消息 |
| `/recall last` | 撤回最后一条消息 |
| `/recall <数量>` | 批量撤回 N 条消息 |
| `/clear history` | 清理播放历史和日志 |
| `/help` | 显示帮助信息 |

## 自动管理

### 脏话自动禁言

Bot 会自动检测所有用户消息中的违规内容，检测到后自动撤回消息并禁言。

**三层检测机制：**

| 层级 | 方式 | 说明 |
|------|------|------|
| 第一层 | 关键词匹配 | 最快，内置 100+ 敏感词（含谐音、形近字变体） |
| 第二层 | 上下文拼接 | 把用户最近多条消息拼起来检测，防止一个字一个字发送绕过 |
| 第三层 | AI 智能识别 | 关键词未命中时调用豆包 AI 判断，能识别隐晦辱骂 |

**防绕过能力：**
- 谐音字："斯妈"（死妈）、"啥比"（傻逼）、"苟日的"（狗日的）
- 形近字/繁体：自动归一化（艹→草、屄→逼、媽→妈 等）
- 拆字发送：30 秒内的消息自动拼接检测
- Emoji 替代：🐎→马、🐕→狗、💀→死
- 打码符号：自动去除 `*`、`#` 等干扰字符
- AI 兜底：以上都未命中时，AI 从语义层面判断

**配置项：** 详见 [配置说明](configuration.md) 中的 `PROFANITY_CONFIG`。

### 域成员加入/退出通知

启用后，当有用户**加入**或**退出**当前域时，Bot 会在公屏发送欢迎/再见消息（使用公告样式）。

| 行为 | 说明 |
|------|------|
| 用户加入域 | 通过轮询域成员 API 检测新成员（可配置间隔，默认 1 秒；发欢迎后 0.5 秒即下次轮询） |
| 用户退出域 | 通过 WebSocket 推送（event 11 等）实时发再见消息 |

需配置 `default_area`、`default_channel`（或由 Bot 自动取第一个已加入域及第一个文字频道）。**配置项：** 详见 [配置说明](configuration.md) 中的 `AREA_JOIN_NOTIFY`。

## Web 播放器

访问 `http://<服务器IP>:8080/` 即可打开 Web 播放器。Bot 点歌消息中会自动附带可点击的播放器链接。

> 播放器地址自动检测：优先获取公网 IPv4，无公网时回退内网 IP。也可在 `WEB_PLAYER_CONFIG.url` 中手动指定。

### 功能

| 功能 | 说明 |
|------|------|
| 实时状态 | 显示当前播放歌曲、封面、进度、歌词 |
| 歌词同步 | 原文歌词 + 翻译歌词，自动滚动高亮 |
| 播放控制 | 暂停/播放、进度拖拽跳转、音量调节 |
| 队列管理 | 查看队列、置顶、删除 |
| 搜索点歌 | 搜索网易云音乐并直接添加到队列 |
| 喜欢的音乐 | 浏览网易云喜欢列表（分页），一键添加到队列 |
| 切歌/停止 | 下一首、停止并清空队列 |
| 频道通知 | Web 点歌后自动在语音频道发送通知消息 |

### 控制响应速度

Web 控制命令通过 Redis `BLPOP` 实时消费，延迟 < 100ms。前端采用乐观更新策略，操作（暂停/播放/进度/音量）立即反映在 UI 上，无需等待后端确认。

## 权限说明

- **管理命令**（播放/停止/禁言/撤回等）仅限 `ADMIN_UIDS` 中的用户执行
- **公共命令**（已加载插件提供的 LOL 查询/战绩查询、每日语录、AI 画图）所有用户均可使用
- `ADMIN_UIDS` 为空时不做权限限制
- 脏话自动禁言默认对所有非管理员用户生效（可通过 `skip_admins` 配置）
- **Web 播放器** 无需登录，局域网内可用

## 插件命令显示

- `/help` 中的“已加载扩展命令”仅显示当前已加载插件提供的命令。
- 若插件未加载或配置未启用，对应命令不会在该区块显示。
